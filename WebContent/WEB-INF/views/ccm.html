<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="description" content="Program Details Form Wizard">
      <meta name="author" content="Yokohama">
      <meta name="keyword" content="YMPACT">
      <title>CCM Details</title>
      <!-- Bootstrap core CSS -->
         <link href="resources/css/bootstrap.min.css" rel="stylesheet">
    <link href="resources/css/bootstrap-reset.css" rel="stylesheet">
       
          <!--Date Picker--> 
      <link rel="stylesheet" type="text/css" href="resources/assets/bootstrap-datepicker/css/datepicker.css" />
      <link rel="stylesheet" type="text/css" href="resources/assets/bootstrap-daterangepicker/daterangepicker-bs3.css" />
      <link rel="stylesheet" type="text/css" href="resources/assets/jquery-multi-select/css/multi-select.css" />
      <link rel="stylesheet" type="text/css" href="resources/assets/bootstrap-timepicker/compiled/timepicker.css" />
      <link rel="stylesheet" type="text/css" href="resources/assets/bootstrap-colorpicker/css/colorpicker.css" />
      <link rel="stylesheet" type="text/css" href="resources/assets/bootstrap-datetimepicker/css/datetimepicker.css" />
      
    <!--external css-->
    <link href="resources/assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <link rel="stylesheet" href="resources/assets/data-tables/DT_bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="resources/assets/jquery-multi-select/css/multi-select.css" />

    <!--select 2-->
    <link rel="stylesheet" type="text/css" href="resources/assets/select2/css/select2.min.css"/>

      <!--right slidebar-->
      <link href="resources/css/slidebars.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="resources/css/style.css" rel="stylesheet">
    <link href="resources/css/style-responsive.css" rel="stylesheet" />
    <link href="resources/css/status_icons.css" rel="stylesheet" />
    
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
	<script src="https://cdn.datatables.net/1.10.4/js/jquery.dataTables.min.js"></script>
	<link rel="stylesheet" href="https://cdn.datatables.net/1.10.4/css/jquery.dataTables.min.css">
	

<link rel="stylesheet" href="https://cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="https://cdn.datatables.net/buttons/1.3.1/css/buttons.dataTables.min.css">
<style>
		 td,th {
		    white-space:nowrap;
		}
		th{
				text-align: center;
			}
 		.dataTables_wrapper .dataTables_filter {
		    width: 50%;
		} 
		.dataTables_filter label input{
		 width: 50%;
		}
		.right{
		text-align:right;
		}
</style>
    
       <script type="text/javascript">
       
       $(document).ready(function () { 
     	   
    	   $(".js-example-basic-single").select2();

           $(".js-example-basic-multiple").select2();
           
    	   
    	$('#ccmtable th').attr('style', 'padding-left: 20px !important;padding-right:20px !important');
    	   
    	table=$("#ccmtable").DataTable( {
			 oLanguage: {
				 "sEmptyTable": "No data available for this selection"
				 },
			processing: true,	 
			lengthMenu: [[10, 25, 50, 100, -1], [10, 25, 50, 100, "All"]],	 
			
		    ajax: {
		        url: '/SIM/ccm/v1/getCcmDetails/Monthly/Consumer/0000000/Not Reviewed',
		        dataSrc: "data",
		        type: "GET",
		    },
		  
	    
		    columns: [	
				{ data: "edit",
					orderable: false,
	                render: function ( data, type, row, meta ) {
	                      if(type === 'display'){
	                    	  if((row.programStatus=='Submitted')){
	                         	data='<a href=# data-toggle="tooltip" data-placement="right" title="Click Unlock to Edit" id="unlock'+meta.row+'" onclick="unlock(this);"><button class="btn btn-default">Unlock</button></a>';
	                     	 }else{
	                     		data='<a href=# id="unlock'+meta.row+'"><button disabled class="btn btn-default">Unlock</button></a> '; 
	                     	 }
	                      }

	                      return data;
	             }}, 
		    	{ data: "bu" },
	            { data: "accountManager" },
	            { data: "zoneManager" },
	            { data: "frequency"},
	            { data: "accrualStartDate" },
	            { data: "accrualEndDate"},
	            { data: "programId"},
	            { data: "programName" },
	            { data: "description",  
	            	render: function ( data, type, row, meta ) {
                    if(type === 'display'){
                        data = '<span data-toggle="tooltip" title="' + data + '">' + data + '</span>';
                    }

                    return data;
                } },				            
	            { data: "paidBasedOn",
                	render: function ( data, type, row, meta ) {
                    if(type === 'display'){
                        data = '<div data-id="'+row.baseId+'" id="paidbase'+meta.row+'">' + data+'</div>';
                    }

                    return data;
                } },
                { data: "creditBasedOn",
                	className:"right",
                	render: function ( data, type, row, meta ) {
              	  if(type === 'display'){
            		  data = '<div id="creditbasedon'+meta.row+'">' + data+'</div>';
                  }

                  return data;
              	} },
	            { data: "guarantee" },
	            { data: "amount", 
	            	className:"right",
	            	render: function ( data, type, row, meta ) {
                    if(type === 'display'){
                        data = '<div id="amt'+meta.row+'">' + data+'</div>';
                    }

                    return data;
                }},
	            { data: "creditAccured",
                	className:"right",
                	render: function ( data, type, row, meta ) {
                    if(type === 'display'){
                  	  data = '<div id="creditaccrued'+meta.row+'">$ ' +data+'</div>';
                    }

                    return data;
                }},
	            { data: "earned", 
                	className:"right",
                	render: function ( data, type, row, meta ) {
                    if(type === 'display'){
                        data = '<input type="text" id="earned'+meta.row+'" name="earned" class="right" value="'+data+'" onkeypress="return isNumber(event);" onkeyup="calculateCreditEarned(this)" style="width:100px">';
                    }

                    return data;
                }},
	            { data: "creditEarned", 
                	className:"right",
                	render: function ( data, type, row, meta ) {
                    if(type === 'display'){
                        data = '$ <input type="text" id="creditearned'+meta.row+'"  class="right" name="creditearned" value="'+data+'" onkeypress="return isNumber(event);" onkeyup="calculateVariance(this)" style="width:100px">';
                    }
                    return data;
                } },
	            { data: "variance", 
                	className:"right",
                	render: function ( data, type, row, meta ) {
                    if(type === 'display'){
                  	  data = '<div id="variance'+meta.row+'">' + data+'</div>';
                    }
                    return data;
                }},
                { data: "tbp" },
	           /*  { data: "review", 
                	orderable: false,
                	className:"center",
	                render: function ( data, type, row, meta ) {
	                      if(type === 'display'){
	                    	  if((data=='Reviewed')||(data=='Submitted')){
	                          	data = '<input type="checkbox" id="review'+meta.row+'" value="" data-id='+row.ccmId+' onchange="populateReviewList(this)" checked disabled>';
	                    	  }else{
	                    		data = '<input type="checkbox" id="review'+meta.row+'" value="" data-id='+row.ccmId+' onchange="populateReviewList(this)">';  
	                    	  }
	                      }

	                      return data;
	                  }}, */
	            { data: "submitForApproval", 
	            	orderable: false,
	            	className:"center",
	            	render: function ( data, type, row, meta ) {
                    if(type === 'display'){
                        
                        if((row.programStatus=='Submitted')){
                      	  	  data = '<input type="checkbox" id="submitForApproval'+meta.row+'" value="" data-id='+row.ccmId+' onchange="populateSubmitList(this)" checked disabled>';
	                    	  }else{
	                    		  data = '<input type="checkbox" id="submitForApproval'+meta.row+'" value="" data-id='+row.ccmId+' onchange="populateSubmitList(this)">'; 
	                    	  }
                    }

                    return data;
                }},	            
	           
	           /*  { data: "creditMemo", 
            	  className:"center",
            	  render: function ( data, type, row, meta ) {
                    if(type === 'display'){
                        data = '<input type="checkbox" id="creditmemo'+meta.row+'" value="" >';
                    }

                    return data;
                }}, */
                { data: "comments",
	            	render: function ( data, type, row, meta ) {
                    if(type === 'display'){
                        data = '<input data-toggle="tooltip" title="'+data+'" type="text" id="comments'+meta.row+'" value="">';
                    }

                    return data;
                } },
	            { data: "programStatus" },
	            { data: "docNo",
	            	render: function ( data, type, row, meta ) {
                    if(type === 'display'){
                    	if((row.programStatus=='Submitted')){
                        	 data = '<input type="text" id="docNum'+meta.row+'" value="'+data+'" onkeypress="return isNumber(event);">';
                    	}else{
                    		 data = '<input type="text" id="docNum'+meta.row+'" value="" disabled>';	
                    	}
                    }

                    return data;
                } },
	            { data: "docDate",
                	render: function ( data, type, row, meta ) {
                    if(type === 'display'){
                    	if((row.programStatus=='Submitted')){
                       		data = '<input type="text" id="docDate'+meta.row+'" value="'+data+'"> <img id="calImg'+meta.row+'" src="resources/img/email-img/calendar.png" width="30" onclick="openCalendar(this);">';
                       		//data='<input type="text" class="form-control dpd1" readonly="readonly" id="from" name="from" placeholder="Begin Date" style="background:white;">';
                    	}else{
                    		data = '<input type="text" id="docDate'+meta.row+'" value="" disabled>';	
                    	}
                    }

                    return data;
                }  },
	            { data: "billToNo"},
	            { data: "billToName" },
	            { data: "units",
	            	className:"right",
	            	render: function ( data, type, row, meta ) {
              	  if(type === 'display'){
            		  data = '<div id="units'+meta.row+'">' + data+'</div>';
                  }

                  return data;
              } },				            
	            { data: "bonusableUnits", 
            	  className:"right",
            	  render: function ( data, type, row, meta ) {
              	  if(type === 'display'){
            		  data = '<div id="bonusableunits'+meta.row+'">' + data+'</div>';
                  }

                  return data;
              }},
	            { data: "nadUnits",
            	  className:"right",
            	  render: function ( data, type, row, meta ) {
              	  if(type === 'display'){
            		  data = '<div id="nadunits'+meta.row+'">' + data+'</div>';
                  }

                  return data;
              }  },
	            { data: "unitsNad", 
            	  className:"right",
            	  render: function ( data, type, row, meta ) {
              	  if(type === 'display'){
            		  data = '<div id="units_nad'+meta.row+'">' + data+'</div>';
                  }

                  return data;
              }},
	            { data: "bonusableNad", 
            	  className:"right",
            	  render: function ( data, type, row, meta ) {
              	  if(type === 'display'){
            		  data = '<div id="bonusableunit_nad'+meta.row+'">' + data+'</div>';
                  }

                  return data;
              }},
	            { data: "invSales", 
            	  className:"right",
            	  render: function ( data, type, row, meta ) {
              	  if(type === 'display'){
            		  data = '<div id="invsales'+meta.row+'">$ ' +data+'</div>';
                  }

                  return data;
              }},
	            { data: "bonusableSales",
            	  className:"right",
            	  render: function ( data, type, row, meta ) {
              	  if(type === 'display'){
            		  data = '<div id="bonusablesales'+meta.row+'">$ ' +data+'</div>';
                  }

                  return data;
              }  },
	            { data: "nadSales",
            	  className:"right",
            	  render: function ( data, type, row, meta ) {
              	  if(type === 'display'){
            		  data = '<div id="nadsales'+meta.row+'">$ ' +data+'</div>';
                  }

                  return data;
              } },
	            { data: "invSalesNad",  
            	  className:"right",
            	  render: function ( data, type, row, meta ) {
              	  if(type === 'display'){
            		  data = '<div id="invsales_nadsales'+meta.row+'">$ ' +data+'</div>';
                  }

                  return data;
              } },
	            { data: "bonusableSalesNad", 
            	  className:"right",
            	  render: function ( data, type, row, meta ) {
              	  if(type === 'display'){
            		  data = '<div id="bonusable_nadsales'+meta.row+'">$ ' +data+'</div>';
                  }

                  return data;
              } },				            
	            { data: "warranty",className:"right"},
	            { data: "payTo" },
	            { data: "beginDate" },
	            { data: "endDate"},
	            { data: "glCode"},
	            { data: "paymentMethod" },
	           
	            { data: "ccmId",
                	visible: false,
                	searchable: false
                	}
      ]
		});
    	
    	 $('#ccmtable').on('draw.dt', function () {
             $('[data-toggle="tooltip"]').tooltip();
             $('[id^="docDate"]').datepicker('update', new Date()).on('changeDate', function(e){
         	    $(this).datepicker('hide');
             });
             
         });  
    	 
       });
       </script>
   </head>
   <body>
      <section id="container" class="sidebar-closed">
         <!--header start-->
         <header class="header dark-bg">
            <div class="sidebar-toggle-box" id="sidebar-toggle-box"  style="display:none">
               <i class="fa fa-bars"></i>
            </div>
            <!--logo start-->
            <a href="" class="logo"><img src="resources/img/yokohama-logo.svg" width="132" height="52"></a>
            <!--logo end-->
            <div class="nav notify-row" id="top_menu">
               <!--  notification start -->
               <ul class="nav top-menu">
              <!-- settings start -->
              <!-- settings end -->
             
            <!-- notification dropdown start-->
             <li id="header_notification_bar" class="dropdown">
                  <!-- <a data-toggle="dropdown" class="dropdown-toggle" href="#">

                      <i class="fa fa-bell-o"></i>
                      <span class="badge bg-important">7</span>
                  </a> -->
<!--                   <ul class="dropdown-menu extended notification">
                      <div class="notify-arrow notify-arrow-yellow"></div>
                      <li>
                          <p class="yellow">You have 7 new notifications</p>
                      </li>
                      <li>
                          <a href="#">
                              <span class="label label-success"><i class="fa fa-bell"></i></span>
                              #20543 has been approved
                              <span class="small italic">30 mins</span>
                          </a>
                      </li>
                      <li>
                          <a href="#">
                              <span class="label label-danger"><i class="fa fa-bolt"></i></span>
                               #20543 has been rejected
                              <span class="small italic">4 hrs</span>
                          </a>
                      </li>
                  </ul> -->
              </li>
              <!-- notification dropdown end -->
          </ul>
            </div>
            <div class="top-nav ">
               <ul class="nav pull-right top-menu">
                 <!--  <li>
                     <input type="text" class="form-control search" placeholder="Search">
                  </li> -->
                  <!-- user login dropdown start-->
                  <li class="dropdown">
                     <a data-toggle="dropdown" class="dropdown-toggle" href="#">
                     <!-- <img alt="" src="resources/img/avatar1_small.jpg"> -->
                     <span class="username" id="loginUserName"></span>
                     <b class="caret"></b>
                     </a>
                     <ul class="dropdown-menu extended logout">
                        <div class="log-arrow-up"></div>
<!--                         <li><a href="#"><i class=" fa fa-suitcase"></i>Profile</a></li>
                        <li><a href="#"><i class="fa fa-cog"></i> Settings</a></li>
                        <li><a href="#"><i class="fa fa-bell-o"></i> Notification</a></li> -->
                        <li><a id="logout-btn" href="/SIM/logout"><i class="fa fa-key"></i> Log Out</a></li>
                     </ul>
                  </li>
                  <!-- user login dropdown end -->
               </ul>
            </div>
             <center><h3 style="color:white;font-size: 20px;">Sales incentive management</h2></center>
         </header>
         <!--header end-->
         <!--sidebar start-->
         <aside>
            <div id="sidebar"  class="nav-collapse ">
               <!-- sidebar menu start-->
               <ul class="sidebar-menu" id="nav-accordion">
                  <li>
                     <a class="" href="processLogin">
                     <i class="fa fa-dashboard"></i>
                     <span>My Dashboard</span>
                     </a>
                  </li>
                  <li>
                      <a class="active" href="ccm">
                              <i class="fa fa-tasks"></i>
                              <span>CCM</span>
                      </a>
                  </li>
                  <!-- <li>
                      <a class="" href="accrual">
                              <i class="fa fa-tasks"></i>
                              <span>Accrual</span>
                      </a>
                  </li> -->
                 <!--  <li>
                     <a id="create-program" class="" href="program_details2.html">
                     <i class="fa fa-tasks"></i>
                     <span>Create New Program</span>
                     </a>
                  </li>
                  <li>
                     <a id="edit-program" class="" href="program_details2.html">
                     <i class="fa fa-tasks"></i>
                     <span>Edit Program</span>
                     </a>
                  </li>
                  <li>
                     <a class="" href="program_details_rejected.html">
                     <i class="fa fa-tasks"></i>
                     <span>Edit Rejected Program</span>
                     </a>
                  </li>
                  <li>
                     <a href="login">
                     <i class="fa fa-user"></i>
                     <span>Login Page</span>
                     </a>
                  </li> -->
               </ul>
               <!-- sidebar menu end-->
            </div>
         </aside>
         <!--sidebar end-->
   
         <!--main content start-->
         <section id="main-content">
            <section class="wrapper site-min-height">
               <!-- page start-->
                <div id="program-parent-div" class="row">
                  <div class="col-lg-12">
                     <!--progress bar start-->
                     <section class="panel">
                        <header class="panel-heading">
                           <h3>CCM Detail</h3>
                        </header>
                        <div class="panel-body">
                          <div class="clearfix">
<!--                              <div class="col-lg-12">
                                <h5 data-original-title="Customer Details" data-content="Click on the grey button below to see more info about this customer. Click again to hide it." data-placement="top" data-trigger="hover" class="popovers">CCM Details</h5>
                                

                           </div> -->
                       </div>
                       </div>
						
                <!-- START STEP 1: PROGRAM INFO -->
                           <!-- <form id="wizard-validation-form" name="wizard-validation-form" class="cmxform" action="#" method="post"> -->
                              <div>
                                 <section>
											<div class="form-group clearfix">
												<div class="col-lg-12">
													<h5>CCM Details</h5>
													<div class="row">
														<div class="col-lg-4 col-sm-4" style="width:25%">
															<label class="control-label"
																for="payout_freq_inputselect">Frequency</label> <select
																class="form-control input-sm m-bot15"
																id="payout_freq_inputselect"
																name="payout_freq_inputselect">
															<!-- 	<option value="">- Select -</option> 
																 <option value="Monthly">Monthly</option> 
																  <option value="Quarterly">Quarterly</option> 
																  <option value="Semi-Annually">Semi-Annually</option> 
																  <option value="Annually">Annually</option> 
																  <option value="On Request">On Request</option>  -->
															</select>
														</div>
														<div class="col-lg-4 col-sm-4" style="width:25%">
															<label class="control-label"
																for="buss_inputselect">Business Unit</label> <select
																class="form-control input-sm m-bot15"
																id="buss_inputselect"
																name="buss_inputselect">
																<!--  <option  class="" value="">- Select -</option>  -->
																  <option value="Consumer">Consumer</option> 
																  <option value="Commercial">Commercial</option> 
																  <option value="OTR">OTR</option> 
															</select>
														</div>
														<div class="form-group">
															<div class="col-lg-4 col-sm-4" style="width:25%">
																<label class="control-label"
																for="period_inputselect">Period</label> <select
																class="form-control input-sm m-bot15"
																id="period_inputselect"
																name="period_inputselect">
																<!--  <option  class="" value="">- Select -</option>  
																  <option value="P">Consumer</option> 
																  <option value="T">Commercial</option> 
																  <option value="OTR">OTR</option> -->
															</select>
															</div>															
															
														</div>
														
														<div class="col-lg-4 col-sm-4" style="width:25%">
                                 						 	<a href="#" id="run_report" onclick="runReport();"><button class="btn btn-default"> Run Report</button></a>
                              							</div>
                              							
													</div><br><br>
													
						<div class="table-responsive">
                                 
                                  <div class="adv-table editable-table">
                            <div class="clearfix">
                                    <div class="col-lg-6 col-sm-6" style="float:right;width:30%;">
                                       <form action="#" class="cmxform">
                                              <div class="form-group clearfix">
                                                    <label class="control-label font-weight-bold" for="inputSuccess"><h5>Status: <button data-original-title="To View CCM details by Status:" data-content="Insert your cursor inside the grey box with 'Not Reviewed' selected and choose the types of statuses you want to view." data-placement="right" data-trigger="hover" class="btn btn-info btn-xs popovers"><strong>?</strong></button></h5></label>

                                                  <select class="js-example-basic-single" id="ccm_status">
                                                    <option selected value="Not Reviewed">Not Reviewed</option>
                                                      <!-- <option value="Reviewed">Reviewed</option> -->
                                                      <option value="Submitted">Submitted</option>
                                                  </select>
                                              </div>
                                          </form>
                                      </div>
                                </div>
                          </div>
                          
                                 <div class="btn-group pull-right">
                                <!--  <div class="btn-group">
                                  <div class="">
                                                <select class="form-control input-sm m-bot15 required" id="program_type_select" name="Program Type_inputselect">
                                                   <option id="program_type_inputselect" selected disabled class="required" value="Program Type">Program Type</option>
                                                   <option id="program_type_vbs" value="Calculated Program">Calculated Program</option>
                                                   <option id="program_type_ddf" value="DDF">DDF</option>
                                                    <option id="program_type_coop" value="COOP">COOP</option>
                                                    <option id="program_type_fixed" value="Fixed $">Fixed $</option>
                                                </select>
                                          </div>
                              </div>
                                   <div class="btn-group m-left8">
                                  <a href="/SIM/programDetail?custId=" id="create_new_pgm"><button class="btn btn-default"><i class="fa fa-plus"></i> Create New Program</button></a>
                              </div>
                              <div class="btn-group m-left8">
                                  <a href="/SIM/pricing" id="pricing-form-link"><button class="btn btn-default"><i class="fa fa-plus"></i> Pricing Form</button></a>
                              </div> -->
                                 <div class="btn-group m-left8">
                                  <a href="#"><button class="btn btn-default" id="btnExport" onclick="tableToExcel('ccmtable', 'CCM Details Table')"><i class="fa fa-arrow-down"></i> Export To Excel</button></a>
                              </div>   
                            </div> 

                              
                          <h4 class="tableHeader">Report  Table</h4>
                          <table class="table table-striped table-hover table-bordered" id="ccmtable">
                             <thead>

                              <tr class="rowvis" style="background-color: #cacbce;">
                                <th>Edit</th>
                                <th>Business Unit</th>
								<th>Account Manager</th>
								<th>Zone Manager</th>
                                <th>Frequency</th>
                                <th>Accrual Start Date</th>
                                <th>Accrual End Date</th>
                                <th>Program Id</th>
                                <th>Program Name</th>
                                <th>Description</th>
                                <th>Paid Based On</th>	
                                <th>Credit Based On</th>							
                                <th>Tiered</th>
                                <th>Amount</th>
                                <!-- <th>% or $</th> -->
                                <th>Credit Accrued</th>	
                                <th>Earned Rate</th>	
                                <th>Actual Credit</th>	
                                <th>Variance</th>	
                                <th>TBP Flag</th>
                               <!--  <th><input type="checkbox" id="allreview" value="">&nbsp;&nbsp;&nbsp;Reviewed</th> -->
                                <th><input type="checkbox" id="allsubmit" value="">&nbsp;&nbsp;&nbsp;Submit For Approval</th>                               
                                
                               <!--  <th>Generate Credit Memo Data</th> -->
                                <th>Comments</th>
                                <th>Program Status</th>
                                <th>Doc No</th>
                                <th>Doc Date</th>
                                <th>Bill- To No</th>	
                                <th>Bill - To Name</th>								
                                <th>Units</th>
                                <th>Bonusable Units</th>
                                <th>NAD Units</th>	
                                <th>Units + NAD</th>
                                <th>Bonusable Units + NAD</th>								
                                <th>INV Sales</th>
                                <th>Bonusable Sales</th>
								<th>NAD Sales</th>	
								<th>INV Sales + NAD</th>
                                <th>Bonusable Sales + NAD</th>	
								<th>Warranty $</th>									
								<th>Pay To</th>								
								<th>Begin Date</th>	
								<th>End Date</th>
								<th>GL</th>
								<th>Payment Method</th>	
									
                              </tr>
                               </thead>
                             
                              <tbody>
                                                       
                              </tbody>
                          </table>
                      </div>
<!--                       <div class="col-lg-4 col-sm-4" style="width:100%"><br>
                                 						 	<a href="#" id="ccm_unlock" style="float:right"><button class="btn btn-default">Unlock</button></a>
                                 						 	<span></span>
                                 						 	<a href="#" id="ccm_save" onclick="saveReviewedList();" style="float:right;margin-right:10px"><button class="btn btn-default"> Save Changes</button></a>
                                 						 	<span></span>
                                 						 	<a href="#" id="ccm_submit" onclick="submitForApproval();" style="float:right;margin-right:10px"><button class="btn btn-default"> Submit For Approval</button></a>
                              							</div> -->
													<div  class="row"><br></div>
													
												<!-- END ROW 3 & Program Details section-->

												
													<div id="footer-button" class="modal-footer">
														<a class="btn btn-success" style="text-decoration:none" id="ccm_submit"
															href="javascript: submitForApproval()"><i
															class="fa fa-check-circle"></i>&nbsp;&nbsp;Submit For
															Approval
														</a>&nbsp; 
														 <a class="btn btn-info finish" id="ccm_save"
															href="javascript: saveChanges()"><i
															class="fa fa-save"></i>&nbsp;&nbsp;Save Changes</a> &nbsp;
														&nbsp;</div>
												
											</div> 

											<!-- END ROW 4 -->

											<!-- Start ROW 8 -->
											<div class="clearfix"></div>
											<div class="clearfix"></div>
											
											<!-- END ROW 8 -->

													<div class="modal fade" id="myModal1" tabindex="-1"
															role="dialog" aria-labelledby="myModalLabel"
															aria-hidden="true">
															<div class="modal-dialog">
																<div class="modal-content">
																	<div class="modal-header">
																		<button id="program-confirmation-modal-close"
																			type="button" class="close" data-dismiss="modal"
																			aria-hidden="true">&times;</button>
																		<h4 class="modal-title">Confirmation</h4>
																	</div>
																	<div class="modal-body">
																		<!-- <div class="space15">&nbsp;</div> -->
																		<div class="text-center">
																			<span id="confirmMessage"></span>
																		</div>
																		<!-- <div class="space15"></div> -->
																	</div>
																	<div class="modal-footer">
																		<button class="btn btn-info" type="button"
																			id="program-confirmation-modal-ok"
																			data-toggle="modal" href="#myModal1">
																			<i class="fa fa-save"></i>&nbsp;&nbsp;OK
																		</button>
																	</div>
																</div>
															</div>
														</div>




												
											</div>
											</section>
      <!---- END Review / Confirm Section -->
      </div>
      <!--  </form> -->
        </div>
      </section><!-- end panel section -->
      </div>
      </div>
      <!-- page end-->
      </section><!-- end wrapper site-min-height -->
      </section><!-- end #maincontent -->
      <!--main content end-->
          
      <!--footer start-->
      <footer class="site-footer">
         <div class="text-center">
            2017 &copy; Yokohama Tire Corporation. All rights reserved. The Yokohama Rubber Company Limited
            <a href="#" class="go-top">
            <i class="fa fa-angle-up"></i>
            </a>
         </div>
      </footer>
      <!--footer end-->
      </section>
      <!-- END section id="container" FIRST section after opening body tag  -->
       
       
 <!-- js placed at the end of the document so the pages load faster -->
    <!--   <script src="resources/js/jquery.js"></script> -->
    <script src="resources/js/jquery-ui-1.9.2.custom.min.js"></script>
    <script src="resources/js/jquery-migrate-1.2.1.min.js"></script>
    <script src="resources/js/bootstrap.min.js"></script>
    <script class="include" type="text/javascript" src="resources/js/jquery.dcjqaccordion.2.7.js"></script>
    <script src="resources/js/jquery.scrollTo.min.js"></script>
    <script src="resources/js/jquery.nicescroll.js" type="text/javascript"></script>
    <script type="text/javascript" src="resources/assets/data-tables/jquery.dataTables.js"></script>
    <script type="text/javascript" src="resources/assets/data-tables/DT_bootstrap.js"></script>
    <script src="resources/js/advanced-form-components.js"></script>
    <script type="text/javascript" src="resources/assets/jquery-multi-select/js/jquery.multi-select.js"></script>
    <script src="resources/js/respond.min.js" ></script>
 
	
  <!--right slidebar-->
  <script src="resources/js/slidebars.min.js"></script>
      <script type="text/javascript" src="resources/assets/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
     <!--  <script type="text/javascript" src="resources/assets/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js"></script> -->
      <script type="text/javascript" src="resources/assets/bootstrap-daterangepicker/moment.min.js"></script>
      <script type="text/javascript" src="resources/assets/bootstrap-daterangepicker/daterangepicker.js"></script>
      <script type="text/javascript" src="resources/assets/bootstrap-colorpicker/js/bootstrap-colorpicker.js"></script>
      <script type="text/javascript" src="resources/assets/bootstrap-timepicker/js/bootstrap-timepicker.js"></script>
      <script type="text/javascript" src="resources/assets/jquery-multi-select/js/jquery.multi-select.js"></script>
      <script type="text/javascript" src="resources/assets/jquery-multi-select/js/jquery.quicksearch.js"></script>
      <script type="text/javascript" src="resources/assets/data-tables/jquery.dataTables.js"></script>
      <script type="text/javascript" src="resources/assets/data-tables/DT_bootstrap.js"></script>
    <!--common script for all pages-->
    <script src="resources/js/common-scripts.js"></script>
      <!--select2-->
  <script type="text/javascript" src="resources/assets/select2/js/select2.min.js"></script>

      <script type="text/javascript">

         function openSidebar() {
             $('#main-content').css({
                 'margin-left': '210px'
             });
             $('#sidebar > ul').show();
             $('#sidebar').css({
                 'margin-left': '0'
             });
             $("#container").removeClass("sidebar-closed");
             $('#sidebar-toggle-box').css({
                 'display': 'block'
             });
         }
         function closeSidebar(){
  			if ($('#sidebar > ul').is(":visible") === true) {
  	            $('#main-content').css({
  	                'margin-left': '0px'
  	            });
  	            $('#sidebar').css({
  	                'margin-left': '-210px'
  	            });
  	            $('#sidebar > ul').hide();
  	            $("#container").addClass("sidebar-closed");
         		}
  			$('#sidebar-toggle-box').css({
  		           'display': 'none'
  		       });
  		}
      </script>
  


       
    <!-- Inline javascript to set the user name from model attribute Begin -->
	<script type="text/javascript" th:inline="javascript">
		
	var reviewList=[];
	var submitList=[];
	
		 $(document).ready(function() {
		   var modelAttributeValue = [[${loginUserNameValue}]];
		   $("#loginUserName").html(modelAttributeValue);
		   var emp = [[${EmployeeInfo}]];
		   if(2!=emp[0].ROLE_ID)
		   	{
		   		openSidebar();
			}		   
		  
		   enablebutton();
		   $.ajax({ 
            	type: "GET",
            	dataType: "json",
           		url: '/SIM/ccm/v1/getFrequencyDropDown',
            	success: function(response){
            	fnPopulateDropdown('payout_freq_inputselect', response);	
            	},
            	failure: function(response){
            		alert("Wrongly done");
            	}
        	});
		   
		   $.ajax({ 
           	type: "GET",
           	dataType: "json",
          		url: '/SIM/ccm/v1/getPeriodDropDown',
           	success: function(response){
           	fnPopulateDropdown('period_inputselect', response);	
           	},
           	failure: function(response){
           		alert("Wrongly done");
           	}
       	});
		
		   $('#ccm_status').on('change',function() {
			    enablebutton();
				var freq=$('#payout_freq_inputselect').val();
				var bus=$('#buss_inputselect').val();
				var period=$('#period_inputselect').val();
				var url='/SIM/ccm/v1/getCcmDetails/'+freq+'/'+bus+'/'+period+'/'+$(this).val();
				reviewList=[];
		  		submitList=[];  
				if($(this).val()){
			  	  	  table.ajax.url(url).load();
			  		 
			  	  }else {
			  		  url='/SIM/ccm/v1/getCcmDetails/'+freq+'/'+bus+'/'+period+'/xxx';
			  		  table.ajax.url(url).load();
			  	  }
			  	  
			  	});
		   
		   $('#allreview').on('change',function() {

/* 			   $('[id^="review"]').prop('checked', this.checked);
			   $('[id^="review"]').trigger('change');  */ 
			   var check=this.checked;
			   
			   $('[id^="review"]').each(function(index,data){
				   if(!$(this).is(':disabled')){
					   if(!this.checked==check){
						  $(this).prop('checked', check);  
						  $(this).trigger('change');
					   }
				   }
			   });
			   			   
			   console.log(reviewList);  	
		   });
		   
		   $('#allsubmit').on('change',function() {

/* 			   $('[id^="submitForApproval"]').prop('checked', this.checked);
			   $('[id^="submitForApproval"]').trigger('change'); */ 
			   var check=this.checked;
			   var ret=false;
			   $('[id^="review"]').each(function(index,data){
				   if(!this.checked){
					   message="Kindly review all the options before selecting for approval submission";
			            $("#confirmMessage").html(message);
						$('#myModal1').modal('toggle');
						ret=true;
						$('#allsubmit').prop('checked', false);
						return false;	   
				   }
			   });
			 if(ret){
				 return;
			 }
			   
			   $('[id^="submitForApproval"]').each(function(index,data){
				   if(!$(this).is(':disabled')){					   
					   if(!this.checked==check){
						  $(this).prop('checked', check);  
						  $(this).trigger('change');
					   }
				   }
			   });
			   console.log(submitList);  	
		   });
           
		}); 
		
		 function fnPopulateDropdown(elementId, items){
			 
			 if(items != null){
	         		$.each(items, function (i, item) {
					    $('#'+ elementId).append($('<option>', { 
					        value: item.value,
					        text : item.key 
					    }));
					});
	         	}
			 //code to select the default value in period dropdown
	         	if(elementId=='period_inputselect'){
					var currentDate=new Date();
	      			var currentMonth=currentDate.getMonth().toString();
	      			var currentYear=currentDate.getFullYear();
	      			if(currentMonth.length==1){
	      				if(currentMonth==0){
	      					currentMonth=12;
	      					currentYear=currentYear-1;
	      				}
	      				currentMonth='0'+currentMonth;
	      			}
	      			period=currentYear+''+currentMonth+'01';
	      			$('#period_inputselect').val(period);
	      		}
	         	
			}
		
		 function removeCommaFromAmount(amount){
				if(amount != null){
					return amount.toString().replace(/\,/g,'');
				}
			}
		 
				 
		 function isNumber(evt)
	       {
			 var charCode = (evt.which) ? evt.which : evt.keyCode;
	          if (charCode != 46 && charCode > 31 
	            && (charCode < 48 || charCode > 57)){
	 			 message="Kindly enter only numbers";
		            $("#confirmMessage").html(message);
					$('#myModal1').modal('toggle');
	        	  return false;
	          }
	          return true;
	       }
		 
	
				 
	function calculateCreditEarned(event){
    	 var id=(event.id).substring(6);
			creditEarned='';
			paidBased=$('#paidbase'+id).data('id');			
			amount=removeCommaFromAmount(event.value);
			if(amount!=""){
			amount=parseFloat(event.value);
			}
			amountType="%";
			if($('#amt'+id).html().startsWith("$")){
				amountType="$";
			}
			units=parseInt(removeCommaFromAmount($('#units'+id).html()));
			bonusableUnits=parseInt(removeCommaFromAmount($('#bonusableunits'+id).html()));
			nadUnits=parseInt(removeCommaFromAmount($('#nadunits'+id).html()));
			unitsplusNad=parseInt(removeCommaFromAmount($('#units_nad'+id).html()));
			bonUnitsplusNad=parseInt(removeCommaFromAmount($('#bonusableunit_nad'+id).html()));	
			
			invSales=parseFloat(removeCommaFromAmount($('#invsales'+id).html().substring(1)));
			bonusableSales=parseFloat(removeCommaFromAmount($('#bonusablesales'+id).html().substring(1)));
			nadSales=parseFloat(removeCommaFromAmount($('#nadsales'+id).html().substring(1)));
			salesplusNad=parseFloat(removeCommaFromAmount($('#invsales_nadsales'+id).html().substring(1)));
			bonSalessplusNad=parseFloat(removeCommaFromAmount($('#bonusable_nadsales'+id).html().substring(1)));
			
						
			if(paidBased==3){
				creditEarned=units*amount;
				//$('#creditbasedon'+id).html(units);
			}
			
			if(paidBased==1){
				creditEarned=nadUnits*amount;
				//$('#creditbasedon'+id).html(nadUnits);
			}
			
			if(paidBased==2){
				creditEarned=bonusableUnits*amount;
				//$('#creditbasedon'+id).html(bonusableUnits);
			}
			
			if(paidBased==4){
				creditEarned=(unitsplusNad)*amount;
				//$('#creditbasedon'+id).html(unitsplusNad);
			}
			
			if(paidBased==5){
				creditEarned=(bonUnitsplusNad)*amount;
				//$('#creditbasedon'+id).html(bonUnitsplusNad);
			}
			
			if(paidBased==8){
				creditEarned=invSales*amount;
				//$('#creditbasedon'+id).html(invSales);
			}
			
			if(paidBased==6){
				creditEarned=nadSales*amount;
				//$('#creditbasedon'+id).html(nadSales);
			}
			if(paidBased==7){
				creditEarned=bonusableSales*amount;
				//$('#creditbasedon'+id).html(bonusableSales);
			}
			if(paidBased==9){
				creditEarned=(salesplusNad)*amount;
				//$('#creditbasedon'+id).html(salesplusNad);
			}
			if(paidBased==10){
				creditEarned=(bonSalessplusNad)*amount;
				//$('#creditbasedon'+id).html(bonSalessplusNad);
			}
			
			if(amountType=="%"){
				creditEarned=creditEarned/100;
			}
			creditEarned=parseFloat(creditEarned).toFixed(2);

			creditaccrued=parseFloat(removeCommaFromAmount($('#creditaccrued'+id).html().substring(1)));			
			variance=creditaccrued-creditEarned;
			variance=parseFloat(variance).toFixed(2);
			if(variance<0){
				$('#variance'+id).css({'color':'red'});
			}else{
				$('#variance'+id).css({'color':'black'});
			}
			
			creditEarned= Number(creditEarned).toLocaleString('en',{ minimumFractionDigits: 2 });
			$('#creditearned'+id).val(creditEarned);
			variance= Number(variance).toLocaleString('en',{ minimumFractionDigits: 2 });
			$('#variance'+id).html('$ '+variance);
			
			
      }
          
	function calculateVariance(event){
		var id=(event.id).substring(12);
		if($('#creditearned'+id).val()!=""){
		creditEarned=parseFloat(removeCommaFromAmount($('#creditearned'+id).val()));
		}
		if($('#creditaccrued'+id).html().substring(1)!=""){
		creditaccrued=parseFloat(removeCommaFromAmount($('#creditaccrued'+id).html().substring(1)));
		}
		variance=creditaccrued-creditEarned;
		variance=parseFloat(variance).toFixed(2);	
		if(variance<0){
			$('#variance'+id).css({'color':'red'});
		}else{
			$('#variance'+id).css({'color':'black'});
		}
		variance= Number(variance).toLocaleString('en',{ minimumFractionDigits: 2 });
		$('#variance'+id).html('$ '+variance);
	}
	
	function runReport(){
		
		var freq=$('#payout_freq_inputselect').val();
		var bus=$('#buss_inputselect').val();
		var period=$('#period_inputselect').val();
		var url='/SIM/ccm/v1/getCcmDetails/'+freq+'/'+bus+'/'+period+'/'+$('#ccm_status').val();
	  	table.ajax.url(url).load();
	  	reviewList=[];
 		submitList=[];
	}
	
	function populateReviewList(event){
		var id=(event.id).substring(6);
		//var ccmId=$('#review'+id).data('id');
		if(reviewList.indexOf(id)==-1)
		{
			reviewList.push(id);
		}else{
			reviewList.splice(reviewList.indexOf(id),1)
		}
	}
	
	function populateSubmitList(event){
		var id=(event.id).substring(17);
		/* if((!$('#review'+id).is(':disabled'))&&($('#submitForApproval'+id).is(':checked'))){
			message="Data cannot be submitted before reviewing";
            $("#confirmMessage").html(message);
			$('#myModal1').modal('toggle');
			$('#submitForApproval'+id).prop('checked', false);
			return;	
		} */
		var ccmId=$('#submitForApproval'+id).data('id');
		
		if(reviewList.indexOf(id)==-1)
		{
			reviewList.push(id);
		}else{
			reviewList.splice(reviewList.indexOf(id),1)
		}
		
		if(submitList.indexOf(ccmId)==-1)
		{
			submitList.push(ccmId);
		}else{
			submitList.splice(submitList.indexOf(ccmId),1)
		}
	}
	
	function saveChanges(){
		 var accuralCcmDataList=[];
		 $('[id^="docNum"]:not([disabled])').each(function(index,data){
			 //alert(this.id);
			 var id=this.id.substring(6);
			 if(($('#docNum'+id).val()!="")||($('#docDate'+id).val()!="")){
			 var accuralCcmData = new Object();
			 accuralCcmData.id=$('#submitForApproval'+id).data('id');
			 accuralCcmData.comments=$('#comments'+id).val();
			 accuralCcmData.docNumber=$('#docNum'+id).val();
			 accuralCcmData.docDate=Date.parse($('#docDate'+id).val());
			 accuralCcmDataList.push(accuralCcmData);
			 }
		   });
		 console.log(JSON.stringify(accuralCcmDataList));
		if(accuralCcmDataList.length==0){
			 message="Kindly enter values to save";
	         $("#confirmMessage").html(message);
			 $('#myModal1').modal('toggle');
			return;
		}
		 $.ajax({ 
	           	type: "POST",
	           	dataType: "json",
	          		url: '/SIM/ccm/v1/updateCCMDetails',
	          		contentType: 'application/json',
					data: JSON.stringify(accuralCcmDataList),
	           	success: function(response){
	            message="Data Saved Successfully";
	            $("#confirmMessage").html(message);
				$('#myModal1').modal('toggle');
	            runReport();
	           	},
	           	failure: function(response){
	           		alert("Wrongly done");
	           	}});
	}
	/* function saveReviewedList(){
		console.log(reviewList);
		var valid=false;
		 $('[id^="review"]').each(function(index,data){
			   if((this.checked)&&(!$(this).is(':disabled'))){				  
					valid=true;
					return false;	   
			   }
		   });
		 
		 if(!valid){
			 message="Kindly select atleast one item to save";
	            $("#confirmMessage").html(message);
				$('#myModal1').modal('toggle');
				return;
		 }
		var accuralCcmDataList=[];
		for(var i=0;i<reviewList.length;i++){
		var id=	reviewList[i];
		var accuralCcmData = new Object();
		accuralCcmData.id=$('#review'+id).data('id');
		accuralCcmData.adjustedAmount=removeCommaFromAmount($('#earned'+id).val());
		accuralCcmData.adjustedCredit=removeCommaFromAmount($('#creditearned'+id).val());
		accuralCcmData.reviewFlag='Reviewed';
		var comments=$('#comments'+id).val();
		if((comments=="")||(comments==null)){
            message="Kindly enter comments for this operation";
            $("#confirmMessage").html(message);
			$('#myModal1').modal('toggle');
			$('#comments'+id).focus();
			$('#comments'+id).css("border-color", "#B94A48");
			return;     
		}
		accuralCcmDataList.push(accuralCcmData);
		}
		console.log(JSON.stringify(accuralCcmDataList));
		 $.ajax({ 
	           	type: "POST",
	           	dataType: "json",
	          		url: '/SIM/ccm/v1/saveCCMDetails',
	          		contentType: 'application/json',
					data: JSON.stringify(accuralCcmDataList),
	           	success: function(response){
	            runReport();
	            message="Data Saved Successfully";
	            $("#confirmMessage").html(message);
				$('#myModal1').modal('toggle');
	           	},
	           	failure: function(response){
	           		alert("Wrongly done");
	           	}});
			
		 reviewList=[];
  		 submitList=[];
	} */
	
	function submitForApproval(){
		console.log(submitList);
		var valid=false;
		var comment=true;		
		 $('[id^="submitForApproval"]').each(function(index,data){
			   if((this.checked)&&(!$(this).is(':disabled'))){				  
					valid=true;
					id1=this.id.substring(17);
					var creditearned=parseFloat(removeCommaFromAmount($('#creditearned'+id1).val()));
					var creditaccrued=parseFloat(removeCommaFromAmount($('#creditaccrued'+id1).html().substring(1)));
					var comments=$('#comments'+this.id.substring(17)).val();
					if(((comments=="")||(comments==null))&&(creditearned!=creditaccrued)){			           
						comment=false;
						return false;     
					}					
					
			   }
		   });
		 
		 if(!valid){
			 message="Kindly select atleast one item to submit for approval";
	            $("#confirmMessage").html(message);
				$('#myModal1').modal('toggle');
				
				return;
		 }
		 if(!comment){
			 message="Actual credit not same as Accrued credit. This action requires comments to be entered";
	            $("#confirmMessage").html(message);
				$('#myModal1').modal('toggle');
				$('#comments'+id1).focus();
				return;
		 }
		 
		 
		 var accuralCcmDataList=[];
			for(var i=0;i<reviewList.length;i++){
				var id=	reviewList[i];
				var accuralCcmData = new Object();
				accuralCcmData.id=$('#submitForApproval'+id).data('id');
				accuralCcmData.adjustedAmount=removeCommaFromAmount($('#earned'+id).val());
				accuralCcmData.adjustedCredit=removeCommaFromAmount($('#creditearned'+id).val());
				accuralCcmData.reviewFlag='Submitted';
				accuralCcmData.comments=$('#comments'+id).val();
				accuralCcmDataList.push(accuralCcmData);
			}
		 
		 
		
		     console.log(JSON.stringify(accuralCcmDataList));
	   		 $.ajax({ 
	   	           	type: "POST",
	   	           	dataType: "json",
	   	          		url: '/SIM/ccm/v1/saveCCMDetails',
	   	          		contentType: 'application/json',
	   	          		dataType: "text",
	   					data: JSON.stringify(accuralCcmDataList),
	   	           	success: function(response){
	   	            message="Data Submitted for Approval";
	   	            $("#confirmMessage").html(message);
	   				$('#myModal1').modal('toggle');
	   	            runReport();
	   	           	},
	   	           	failure: function(response){
	   	           		alert("Wrongly done");
	   	           	}});

		 reviewList=[];
  		 submitList=[];
	}
	
	function unlock(event){
		var id=(event.id).substring(6);
		$('#submitForApproval'+id).prop('checked', false);
		$('#submitForApproval'+id).prop('disabled', false);
		$.ajax({ 
           	type: "POST",
           	dataType: "json",
          		url: '/SIM/ccm/v1/updateCCMStatus',
          		contentType: 'application/json',
				data: JSON.stringify($('#submitForApproval'+id).data('id')),
           	success: function(response){
            message="Record Unlocked Successfully";
            $("#confirmMessage").html(message);
			$('#myModal1').modal('toggle');
       		runReport();
           	},
           	failure: function(response){
           		alert("Wrongly done");
           	}});
		
	}
	
	function enablebutton(){
		
		if($('#ccm_status').val()=='Not Reviewed'){
			$('#ccm_submit').show();
			$('#ccm_save').hide();
		}else{
			$('#ccm_submit').hide();
			$('#ccm_save').show();
		}
	}
	
	function openCalendar(event){
		var id=(event.id).substring(6);
		$('#docDate'+id).datepicker('show');
	}
	   //Export to Excel 
	   function tableToExcel(tableId, fileName) {
	   	var ua = window.navigator.userAgent;
	    var msie = ua.indexOf("MSIE");
	    if (navigator.userAgent.indexOf('Trident')>0 || navigator.userAgent.indexOf('Edge')>0)
	    {
	    var tab_text="<table border='2px'><tr bgcolor='#87AFC6'>";
	    var textRange; var j=0;
	    tab = document.getElementById(tableId); // id of table

	    for(j = 0 ; j < tab.rows.length ; j++) 
	    {     
	        tab_text=tab_text+tab.rows[j].innerHTML+"</tr>";
	        //tab_text=tab_text+"</tr>";
	    }

	    tab_text=tab_text+"</table>";
	    tab_text= tab_text.replace(/<A[^>]*>|<\/A>/g, "");//remove if u want links in your table
	    tab_text= tab_text.replace(/<img[^>]*>/gi,""); // remove if u want images in your table
	    tab_text= tab_text.replace(/<input[^>]*>|<\/input>/gi, ""); // reomves input params

	  
	     var txt = document.getElementById('txtArea1').contentWindow;
	        txt.document.open("txt/html","replace");
	        txt.document.write(tab_text);
	        txt.document.close();
	        txt.focus(); 
	        sa=txt.document.execCommand("SaveAs",true,fileName+'.xls');
	    }
	     else
	    {
	     var uri = 'data:application/vnd.ms-excel;base64,'
	   	    , template = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>'
	   	    , base64 = function(s) { return window.btoa(unescape(encodeURIComponent(s))) }
	   	    , format = function(s, c) { return s.replace(/{(\w+)}/g, function(m, p) { return c[p]; }) }
	   	  //return function(table, name) {
	   	    if (!tableId.nodeType) table = document.getElementById(tableId)
	   	    var ctx = {worksheet: fileName || 'Worksheet', table: table.innerHTML}
	   	   // window.location.href = uri + base64(format(template, ctx))
			var a = document.createElement('a');
			a.href = uri + base64(format(template, ctx));
			a.download =  'ccm'+'.xls';
			document.body.appendChild(a);
			a.click();
			document.body.appendChild(a);    
	    } }
	    
            	
	   
			
	</script>
       
	

       
   </body>
</html>